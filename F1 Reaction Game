<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>F1 Reaction Game</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: url('https://i.imgur.com/84zZf6N.jpg') no-repeat center center/cover;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .lights {
      display: grid;
      grid-template-columns: repeat(5, 50px);
      grid-template-rows: repeat(5, 50px);
      gap: 10px;
      margin: 20px;
    }
    .light {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #333;
      border: 2px solid #555;
    }
    .light.on {
      background: red;
    }
    #message {
      margin-top: 20px;
      font-size: 1.2em;
      text-shadow: 2px 2px 4px #000;
    }
    #history {
      margin-top: 20px;
      font-size: 0.9em;
    }
    #average, #best, #leaderboard {
      margin-top: 10px;
      font-size: 1em;
    }
    #average {
      color: #0f0;
    }
    #best {
      color: #ff0;
    }
    #leaderboard {
      color: #0ff;
    }
    #nicknameInput {
      margin-bottom: 15px;
      padding: 5px;
      font-size: 1em;
    }
    #shareBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>F1 Reaction Game</h1>
  <input type="text" id="nicknameInput" placeholder="è¼¸å…¥ä½ çš„æš±ç¨±" />
  <div class="lights" id="lights"></div>
  <button id="startBtn">é–‹å§‹éŠæˆ²</button>
  <div id="message"></div>
  <div id="history"></div>
  <div id="average"></div>
  <div id="best"></div>
  <div id="leaderboard"></div>
  <button id="shareBtn" style="display:none;">åˆ†äº«æˆç¸¾</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    const startBtn = document.getElementById("startBtn");
    const lightsContainer = document.getElementById("lights");
    const message = document.getElementById("message");
    const historyDiv = document.getElementById("history");
    const averageDiv = document.getElementById("average");
    const bestDiv = document.getElementById("best");
    const leaderboardDiv = document.getElementById("leaderboard");
    const shareBtn = document.getElementById("shareBtn");
    const nicknameInput = document.getElementById("nicknameInput");

    let startTime;
    let waiting = false;
    let results = [];
    let lights = [];

    // å‹•æ…‹å»ºç«‹ 5x5 ç‡ˆè™Ÿ
    function createLights() {
      lightsContainer.innerHTML = "";
      lights = [];
      for (let i = 0; i < 25; i++) {
        let div = document.createElement("div");
        div.classList.add("light");
        lightsContainer.appendChild(div);
        lights.push(div);
      }
    }

    function resetLights() {
      lights.forEach(light => light.classList.remove("on"));
    }

    function startGame() {
      resetLights();
      message.textContent = "ç‡ˆè™Ÿæº–å‚™ä¸­... è«‹ç­‰å¾…";
      startBtn.disabled = true;
      let i = 0;

      let interval = setInterval(() => {
        if (i < lights.length) {
          lights[i].classList.add("on");
          i++;
        } else {
          clearInterval(interval);
          setTimeout(() => {
            resetLights();
            message.textContent = "ç‡ˆè™Ÿç†„æ»…ï¼å¿«æŒ‰ä¸‹ç©ºç™½éµæˆ–é»æ“Šè¢å¹•ï¼";
            startTime = Date.now();
            waiting = true;
          }, Math.random() * 2000 + 1000); // 1~3ç§’éš¨æ©Ÿç†„æ»…
        }
      }, 150);
    }

    function endGame() {
      if (!waiting) return;
      let reaction = Date.now() - startTime;
      waiting = false;
      results.push(reaction);
      let nickname = nicknameInput.value || "ç©å®¶";
      message.textContent = `${nickname} çš„åæ‡‰æ™‚é–“: ${reaction} ms - ${getComment(reaction)}`;
      updateHistory();
      updateAverage();
      updateBest();
      updateLeaderboard();
      shareBtn.style.display = "inline-block";
      startBtn.disabled = false;
    }

    function getComment(ms) {
      if (ms < 200) return "ä½ æœ‰æˆç‚ºè³½è»Šæ‰‹çš„æ½›åŠ›!!";
      if (ms < 300) return "ä¸éŒ¯ï¼åæ‡‰å¾ˆå¿«ï¼";
      if (ms < 400) return "æ™®é€šæ°´æº–ï¼ŒåŠ æ²¹ï¼";
      if (ms < 600) return "ç¨æ…¢äº†ï¼Œè¦æ›´å°ˆæ³¨ï¼";
      return "å¤ªæ…¢äº†ï¼Œå†è©¦ä¸€æ¬¡ï¼";
    }

    function updateHistory() {
      historyDiv.innerHTML = "<b>æ­·å²ç´€éŒ„:</b><br>" + results.map((r,i)=> `ç¬¬${i+1}æ¬¡: ${r} ms`).join("<br>");
    }

    function updateAverage() {
      let sum = results.reduce((a,b)=>a+b,0);
      let avg = Math.round(sum / results.length);
      averageDiv.textContent = `å¹³å‡åæ‡‰æ™‚é–“: ${avg} ms`;
    }

    function updateBest() {
      let best = Math.min(...results);
      bestDiv.textContent = `æœ€ä½³åæ‡‰æ™‚é–“: ${best} ms`;
    }

    function updateLeaderboard() {
      let sorted = [...results].sort((a,b)=>a-b).slice(0,3);
      const titles = ["é–ƒé›»æ‰‹ âš¡", "é£›è»Šæ‰‹ ğŸï¸", "è³½é“ç‹ ğŸ"];
      leaderboardDiv.innerHTML = "<b>æ’è¡Œæ¦œ (å‰3å):</b><br>" + sorted.map((r,i)=> `ç¬¬${i+1}å (${titles[i]}): ${r} ms`).join("<br>");
    }

    shareBtn.addEventListener("click", () => {
      let nickname = nicknameInput.value || "ç©å®¶";
      html2canvas(document.body, {width:1280, height:720}).then(canvas => {
        let link = document.createElement("a");
        link.download = `${nickname}_reaction_result.png`;
        link.href = canvas.toDataURL();
        link.click();
      });
    });

    startBtn.addEventListener("click", startGame);
    document.body.addEventListener("keydown", e => { if (e.code === "Space") endGame(); });
    document.body.addEventListener("click", endGame);

    // åˆå§‹åŒ–å»ºç«‹ç‡ˆè™Ÿ
    createLights();
  </script>
</body>
</html>
